package cmisl.Shiro;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

@Controller
public class UserController {

    @GetMapping("/")
    public String home() {
        return "redirect:/home.html";
    }

    @GetMapping("/login")
    public String loginPage() {
        return "redirect:/login.html";
    }

    @GetMapping("/unauthorized")
    public String unauthorizedPage() {
        return "redirect:/unauthorized.html";
    }

    @GetMapping("/CVE-2022-40664")
    @ResponseBody
    public String CVE_2022_40664() {
        return "success";
    }

    @GetMapping("/cmisl")
    public String CVE_2022_40664_test() {
        return "forward:/CVE-2022-40664";
    }

    @PostMapping("/toLogin")
    public String doLoginPage(@RequestParam("username") String username, @RequestParam("password") String password, @RequestParam(name="rememberme", defaultValue="") String rememberMe){
        if(ShiroUtil.login(username, password)){
            if(ShiroUtil.hasRole("admin")){
                return "redirect:/admin.html";
            } else if (ShiroUtil.hasRole("user")) {
                return "redirect:/user.html";
            }
        }
        return "redirect:/unauthorized.html";
    }

}
