package cmisl.Shiro;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

@Controller
public class UserController {

    @GetMapping("/")
    public String home() {
        return "redirect:/home.html";
    }

    @GetMapping("/login")
    public String loginPage() {
        return "redirect:/login.html";
    }

    @GetMapping("/unauthorized")
    public String unauthorizedPage() {
        return "redirect:/unauthorized.html";
    }

//    @GetMapping("/CVE-2020-17510")
//    @ResponseBody
//    public String CVE_2020_17510() {
//        // 返回简单的 HTML 页面内容
//        return "<html>\n" +
//                "<head>\n" +
//                "    <title>CVE-2020-17510 Page1</title>\n" +
//                "</head>\n" +
//                "<body>\n" +
//                "    <h1>Welcome to CVE-2020-17510 Page</h1>\n" +
//                "    <p>This is a page that requires administrator privileges.</p>\n" +
//                "</body>\n" +
//                "</html>";
//    }

    @GetMapping("/CVE-2020-17510/{test}")
    @ResponseBody
    public String CVE_2020_17510_test(@PathVariable String test) {
        return "<html>\n" +
                "<head>\n" +
                "    <title>CVE-2020-17510 Page</title>\n" +
                "</head>\n" +
                "<body>\n" +
                "    <h1>Welcome to CVE-2020-17510 Page</h1>\n" +
                "    <p>This is a page that requires administrator privileges.</p>\n" +
                "    <p>test:</p>" + test +
                "</body>\n" +
                "</html>";
    }

    @PostMapping("/toLogin")
    public String doLoginPage(@RequestParam("username") String username, @RequestParam("password") String password, @RequestParam(name="rememberme", defaultValue="") String rememberMe){
        if(ShiroUtil.login(username, password)){
            if(ShiroUtil.hasRole("admin")){
                return "redirect:/admin.html";
            } else if (ShiroUtil.hasRole("user")) {
                return "redirect:/user.html";
            }
        }
        return "redirect:/unauthorized.html";
    }

}
